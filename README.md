# 프로젝트 개요

![Simulator Screen Recording - iPhone 14 - 2023-09-11 at 03 14 47](https://github.com/Jimmy-Jung/NaverShoppingList/assets/115251866/238b8774-6c14-49e2-a6ba-1bf9be315c4c)

이 프로젝트는 네이버 쇼핑 API를 활용하여 상품 검색 및 저장이 가능한 iOS 앱입니다. 앱은 API에 접근하기 위해 인터넷 연결이 필요하며, Swift를 사용하며 사용자 데이터는 Realm 데이터베이스에 저장됩니다.

# 요구사항

이 프로젝트는 다음과 같은 요구사항을 충족해야 합니다.

## Scene 1: 검색 화면

✅ 왼쪽 이미지와 유사한 형태로 검색 화면을 구현합니다.  

✅ 검색 데이터는 네이버 쇼핑 API를 활용합니다.

✅ 검색 버튼(리턴키)을 통해 API를 요청합니다.

✅ 데이터는 30개를 기준으로 페이지네이션 처리를 합니다.

✅ 검색어가 변경되면 목록을 리셋한 후 다시 데이터를 fetch합니다.

✅ API 쿼리를 활용하여 정렬 기능을 구현합니다.

✅ 아무 것도 검색하지 않았을 경우 빈 목록을 보여주시면 됩니다.

✅ 셀에서는 image, malIName, title, Iprice 정보를 확인할 수 있으며, title은 2줄까지 보여집니다.

✅ 사용자가 좋아요를 설정하거나 취소할 수 있습니다.

✅ 선택 시 설명서 화면으로 이동합니다.

## Scene 2: 즐겨찾기 화면

✅ 왼쪽 이미지와 유사한 형태로 좋아요 목록 화면을 구현합니다.

✅ 검색 화면이나 상세 화면에서 좋아요를 설정한 전체 상품을 출력합니다.

✅ 좋아요 목록은 등록순으로 정렬합니다. 최근에 추가한 상품이 가장 상단에 배치됩니다.

✅ 서치바에서는 실시간 검색 기능이 지원됩니다.

✅ 데이터베이스에 저장된 좋아요 목록에서 실시간 검색이 진행됩니다.

✅ 검색 쿼리는 title로 제한합니다.

✅ 아무 것도 검색하지 않았을 경우 전체 상품을 출력합니다.

✅ 셀 UI는 검색 화면의 셀과 동일합니다.

✅ 사용자는 좋아요를 설정하거나 취소할 수 있습니다.

✅ 좋아요를 취소한 쇼핑 데이터는 좋아요 목록 화면에서 사라집니다.

✅ 셀 선택 시 상세 화면으로 이동합니다.

## Scene 3: 상세 화면

✅ 왼쪽 이미지와 유사한 형태로 상세 화면을 구현합니다.

✅ 검색 화면과 좋아요 목록 화면에서 셀을 선택했을 때, 상세 화면이 보입니다.

✅ 네비게이션 영역에는 상품 타이틀과 상품의 좋아요 상태가 표시됩니다.

✅ 웹뷰를 통해 상품 링크 페이지를 보여줍니다.

✅ 상품 링크 URL은 API Response의 {productld}를 활용하여 구성합니다.

✅ 사용자는 좋아요를 설정하거나 취소할 수 있습니다.

# 기술 스택

이 프로젝트는 다음과 같은 기술 스택을 사용합니다.

- iOS 13 +
- URLSession (네트워킹)
- NSCache (이미지 캐시)
- JSONDecoder (JSON 파싱)
- Realm (데이터베이스)
- UnitTest (APIService 테스트)

# 구현 방법

이 프로젝트는 다음과 같이 구현되었습니다.

## 아키텍처

이 애플리케이션은 MVC 아키텍처를 적용하였습니다. 

## 네트워킹

URLComponents를 사용해 QueryItem을 관리합니다.

JSONDecoder를 통해 JSON데이터를 디코딩합니다.

Async Await을 사용해 비동기 처리합니다.

Result타입을 사용해 데이터를 반환합니다.

UnitTest를 작성해 서버와 올바르게 통신하는지 확인합니다.

## 에러처리

Error종류를 enum으로 만들어 관리합니다.

NaverAPI에서 발생한 오류를 JSON값을 받아와 디코딩하고

ErrorCode에 따라 알람을 띄워줍니다.

## 검색 화면

페이지네이션은 스크롤 끝에 위치하면 페이지당 30개의 항목으로 처리됩니다. 

정렬버튼은 CollectionView를 사용해 만들었습니다

정렬값에 따라 정리된 결과값을 가져올 수 있습니다

즐겨찾기 버튼 클릭시 버튼의 이미지를 교체하고 Realm에 데이터를 저장합니다.

## 즐겨찾기 화면

Realm에 저장된 모든 제품을  표시합니다. 

데이터 저장시 현재시간을 저장해 최신순으로 정렬합니다.

사용자는 검색 바를 사용하여 실시간으로 즐겨찾기를 검색할 수 있습니다. 

즐겨찾기는 Realm에 추가된 시간에 따라 정렬되며, 가장 최근 항목이 맨 위에 표시됩니다. 

## 상세 화면

상세 화면은 제품의 제목, 이미지, 몰 이름, 가격 정보 및 웹의 제품 페이지 링크를 표시합니다. 

사용자는 이 화면에서 제품을 즐겨찾기에 추가하거나 제거할 수 있습니다.

# 트러블 슈팅

이 프로젝트에서 발생한 문제와 해당 문제를 해결한 방법은 다음과 같습니다.

## 문제 1: API 호출 시 어떤 문제인지 확인이 어려움

API 호출 시 어떤 에러가 발생했는지 확인하기 위해 print로 확인하는 것만으로는 어려움이 있습니다. 

따라서, 유닛 테스트 코드를 작성하여 APIService 코드를 테스트했습니다.

## 문제 2: 정렬버튼 찌그러짐 문제

정렬버튼의 너비가 동적으로 생성되지 않고 찌그러지는 문제가 발생했습니다.

UICollectionViewFlowLayout설정시 automaticSize를 적용해 해결했습니다

## 문제 3: 검색화면과 좋아요 화면 동기화 문제

검색 화면에서 즐겨찾기를 등록하면 좋아요 화면에서 적용된 화면이 보이지 않는 문제가 발생했습니다.

```swift
private var realmShoppingResult: Results<RealmShoppingData>! {
    didSet {
        mainView.resultsCollectionView.reloadData()
    }
}

```

프로퍼티에 Realm 결과값을 등록하여 수정된 값이 자동으로 반응하도록 수정하였습니다.

### 문제 4: 이미지 메모리 캐싱과 디스크 캐싱

Kingfisher 대신 코드를 작성하여 서버에서 받아온 이미지를 캐싱 처리하는 코드를 작성하는데 어려움이 있었습니다.

먼저 Realm에 이미지가 저장되어 있는지 확인합니다. 

이미지가 없으면 캐시에 있는지 확인하고, 

마지막으로 URL을 통해 이미지를 요청합니다. 

이미지를 받아오지 못한 경우, placeholder 이미지를 제공합니다.

# 회고

이번 프로젝트를 통해 iOS 앱 개발에 대해 많이 배울 수 있었습니다.

특히 네트워킹, 데이터베이스, 이미지 캐싱 등 다양한 기술을 적용해볼 수 있어서 좋았습니다.

문제가 발생해 해결해야 할 때마다 구글링을 하면서 많이 배웠습니다.

특히 유닛 테스트 코드를 작성해 API 호출시 발생한 에러를 확인하는 것은 실제 개발에서도 매우 유용하게 사용될 것 같습니다.

하지만 문제가 발생할 때마다 원인을 찾아내는 것은 쉽지 않았습니다. 조금 더 체계적인 방법과 경험이 필요할 것 같습니다.

그리고 아쉬운 점은 UI/UX 디자인에 대한 부분입니다. 

처음에는 스켈레톤 뷰와 버튼 클릭 효과를 적용하여 멋진 UI를 구현하려 했지만, 공수 산정에 실패하여 급하게 앱을 제작하게 되었습니다.
